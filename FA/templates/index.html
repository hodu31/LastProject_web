<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>NotiCare : Team 3 - main</title>
        <link
      rel="icon"
      href="/static/mainapp/img/noticarelogo.png"
      type="image/x-icon"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Bootstrap JavaScript 및 jQuery (jQuery는 Bootstrap의 일부) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>

    <!-- FontAwesome 4.3.0 -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- Ionicons 2.0.0 -->
    <link href="https://code.ionicframework.com/ionicons/2.0.0/css/ionicons.min.css" rel="stylesheet" type="text/css" />    
    <!-- Theme style -->
    <link href="/static/mainapp/dist/css/AdminLTE.min.css" rel="stylesheet" type="text/css" />
    <!-- AdminLTE Skins. Choose a skin from the css/skins 
         folder instead of downloading all of them to reduce the load. -->
    <link href="/static/mainapp/dist/css/skins/_all-skins.min.css" rel="stylesheet" type="text/css" />
    <!-- iCheck -->
    <link href="/static/mainapp/plugins/iCheck/flat/blue.css" rel="stylesheet" type="text/css" />
    <!-- Morris chart -->
    <link href="/static/mainapp/plugins/morris/morris.css" rel="stylesheet" type="text/css" />
    <!-- jvectormap -->
    <link href="/static/mainapp/plugins/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
    <!-- Date Picker -->
    <link href="/static/mainapp/plugins/datepicker/datepicker3.css" rel="stylesheet" type="text/css" />
    <!-- Daterange picker -->
    <link href="/static/mainapp/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
    <!-- bootstrap wysihtml5 - text editor -->
    <link href="/static/mainapp/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />
    <!-- Style 적용 768px => 스마트폰 크게에서만 적용 -->
  <style>

    .sidebar-toggle {
    width: 10px;  /* 원하는 너비로 조절 */
    height: 10px; /* 원하는 높이로 조절 */
}
    .sidebar-toggle::before {
        vertical-align: middle;
    }

    
    /* 스마트폰 기준 footer 맞추기 */
    @media (max-width: 768px) {
        .main-footer {
            display: flex;
            flex-direction: column; /* 수직 방향으로 아이템을 정렬 */
            align-items: center; /* 가로 방향 중앙 정렬 */
            justify-content: center; /* 세로 방향 중앙 정렬 */
            text-align: center; /* 텍스트 중앙 정렬 */
        }

        .btn-container {
            display: flex; /* 버튼들을 가로로 배열 */
            justify-content: center; /* 버튼들을 가운데에 위치시킴 */
        }

        .btn-flat {
            width: max-content; /* 버튼의 너비를 내용물에 맞게 조절 */
            margin: 10px; /* 버튼의 여백을 주고, 좌우 중앙 정렬 */
        }

        .hidden-xs {
            display: block;
        }
    }


    /* 스마트폰 기준 우측 로그인 기능 맞추기 */
    @media (max-width: 768px) {
        .navbar-custom-menu .nav > li {
            margin-left: 5px;
            margin-right: 5px;
        }

        .user-image {
            width: 25px;
            height: 25px;
        }

        .navbar-nav > .user-menu .dropdown-menu {
            width: 250px;
            color: black;
            background-color: white;  /* 배경색을 흰색으로 설정 */
        }

        .navbar-custom-menu .nav > li > .dropdown-toggle {
            display: flex;
            align-items: center;
        }

        .navbar-custom-menu .nav > li > a {
            font-size: 12px;
        }

        .hidden-xs {
            display: block;
            font-size: 12px;
            margin-left: 10px; /* 이미지와 텍스트 사이의 간격 조절 */
        }

        .dropdown-item {
            display: block;
            color: black !important;  /* 글자 색상을 검은색으로 강제 설정 */
            background-color: white;  /* 배경색을 흰색으로 설정 */
            padding: 8px 15px;  /* padding을 추가하여 클릭 영역 확대 */
        }
    }


    /* 좌측 사이드 바 드롭다운 토글 아이콘 맞추기 */
    .sidebar-toggle {
        position: relative;
        display: inline-block; /* 블록 요소로 만들어 내부 아이콘과의 간격을 조정할 수 있게 합니다. */
        padding: 0 20px; /* 오른쪽 패딩을 주어 아이콘을 버튼의 내부 중앙에 위치시킵니다. */
        line-height: 1.5; /* 버튼 높이와 맞추기 위해 조정합니다. 필요에 따라 값 변경 가능합니다. */
    }

    .sidebar-toggle::before {
        content: "\2630"; /* 햄버거 메뉴 아이콘으로 간단한 예를 들었습니다. */
        position: absolute;
        right: 10px; /* 오른쪽에서 10px 떨어진 위치에 아이콘을 배치합니다. */
        top: 50%; /* 상위 요소의 중앙에 아이콘을 배치합니다. */
        transform: translateY(-50%); /* 아이콘을 수직으로 중앙 정렬합니다. */
    }

    /* 스마트폰 화면에서만 적용되는 미디어 쿼리 */
    @media (max-width: 768px) {
      .main-sidebar {
          top: 30px; /* 네비게이션 바의 높이에 따라 조절이 필요합니다. */
      }
}

    @media (max-width: 768px) {
        .sidebar .sidebar-form .input-group {
            display: flex;
            align-items: center;
        }
    }

  .dropdown-menu {
    width: 30px !important;  /* 원하는 크기로 조절 */
    border-radius: 10px !important;  /* 모서리를 둥글게 */
    text-align: center !important;  /* 텍스트를 중앙에 배치 */
}


  .box.box-solid.bg-teal-gradient {
    height: 420px; /* 원하는 높이로 설정하세요 */
  }

</style>

</head>
<!--                   네비 다 복사 가능                      -->
  <body class="skin-blue">
    <div class="wrapper">
      <header class="main-header">
        <!-- Logo -->
        <a href="/index" class="logo"><b>NotiCare-</b>Team 3</a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top" role="navigation">
          <div>
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button"></a>
          </div>
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
              <li class="dropdown tasks-menu">
              <!-- User Account: style can be found in dropdown.less -->
              {% if user %}
                  <!-- 로그아웃 버튼 표시 -->
                  <li class="dropdown user user-menu">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                          <img src="/static/mainapp/dist/img/cat5.jpg" class="user-image" alt="User Image"/> <!-- 원래 이미지 유지 -->
                          <span class="hidden-xs">({{ user.USER_STORE }}) {{ user.USER_NM }}님 환영합니다.</span>
                      </a>
                      <ul class="dropdown-menu">
                          <li><a href="/logout/" class="dropdown-item">로그아웃</a></li>
                      </ul>
                  </li>
              {% else %}
                  <!-- 로그인 버튼 표시 -->
                  <li class="dropdown user user-menu">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                          <img src="/static/mainapp/dist/img/login-user.jpg" class="user-image" alt="User Image"/> <!-- 이미지 변경 -->
                          <span class="hidden-xs">로그인</span>
                      </a>
                      <ul class="dropdown-menu">
                          <li><a href="/login" class="dropdown-item">로그인</a></li>
                      </ul>
                  </li>
              {% endif %}
                <ul class="dropdown-menu">
                </ul>
              </li>
            </ul>
          </div>
        </nav>
      </header>
      <!-- Header 끝 -->

      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
          <!-- Sidebar user panel -->
        <div class="user-panel">
            <div class="pull-left image">
                {% if user %}
                    <!-- 로그인한 사용자의 이미지 -->
                    <img src="/static/mainapp/dist/img/cat5.jpg" class="img-circle" alt="User Image" />
                {% else %}
                    <!-- 게스트 이미지 -->
                    <img src="/static/mainapp/dist/img/login-user.jpg" class="img-circle" alt="User Image" />
                {% endif %}
            </div>
            <div class="pull-left info">
                {% if user %}
                    <!-- 로그인한 사용자의 이름 -->
                    <p>{{ user.USER_NM }}</p>
                    <a href="/index"><i class="fa fa-circle text-success"></i> Online</a>
                {% else %}
                    <!-- 게스트 -->
                    <p>Guest</p>
                    <a href="/index"><i class="fa fa-circle text-danger"></i> Offline</a>
                {% endif %}
            </div>
        </div>
          <!-- Sidebar user panel 끝-->

          <!-- search form -->
          <form action="https://www.google.com/search" method="get" class="sidebar-form">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="검색..."/>
                <span class="input-group-btn">
                    <button type="submit" name="search" id="search-btn" class="btn btn-flat">
                        <i class="fa fa-search"></i>
                    </button>
                </span>
            </div>
          </form>
          <!-- /.search form 끝 -->

          <!-- sidebar menu: : style can be found in sidebar.less -->
          <ul class="sidebar-menu">
            <li class="header">MAIN NAVIGATION</li>
            <li class="active treeview">
              <a href="/index">
                <i class="fa fa-dashboard"></i> <span>Dashboard</span>
              </a>
            </li>
            <li class="treeview">
              <a href="/static/mainapp/pages/charts/morris.html">
                <i class="fa fa-pie-chart"></i>
                <span>Charts</span>
              </a>
            </li>
            <li>
              <a href="/static/mainapp/pages/calendar.html">
                <i class="fa fa-calendar"></i> <span>Calendar</span>
              </a>

            <li><a href="/"><i class="fa fa-book"></i> About Us</a></li>
            <li class="header">Area</li>
            <li><a href="/index"><i class="fa fa-circle-o text-info"></i> 매장 행동감지</a></li>
            <li><a href="/index2/"><i class="fa fa-circle-o text-warning"></i> 병원 행동감지</a></li>
            <li><a href="/index3"><i class="fa fa-circle-o text-danger"></i> 가정 행동감지</a></li>
          </ul>
        </section>
        <!-- /.sidebar 끝 -->
      </aside>
<!--                   네비 다 복사 가능                      -->

      <!-- Right side column. Contains the navbar and content of the page -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>
            Dashboard
            <small>Control panel</small>
          </h1>
        </section>

        <!-- Main content -->
        <section class="content">
          <!-- Small boxes (Stat box) -->
          <div class="row">
            <div class="col-lg-3 col-xs-6">
              <!-- small box -->
              <div class="small-box bg-blue">
                <div class="inner">
                  <h3 id="dan-count">{{ dan_count }}</h3>
                  <p>매장 내 행동 감지</p>
                </div>
                <div class="icon">
                  <i class="fa fa-video-camera"></i> <!-- CCTV 아이콘 클래스: fa-video-camera -->
                </div>
                <a href="/static/mainapp/pages/charts/morris.html" class="small-box-footer">자세히 <i class="fa fa-arrow-circle-right"></i></a>
              </div>
            </div><!-- ./col -->
            <div class="col-lg-3 col-xs-6">
              <!-- small box -->
              <div class="small-box bg-red">
                <div class="inner">
                  <h3 id="dan2-count">{{ dan_count2 }}0</h3>
                  <p>이상 감지 현황</p>
                </div>
                <div class="icon">
                  <i class="ion ion-stats-bars"></i>
                </div>
                <a href="/static/mainapp/pages/charts/morris.html" class="small-box-footer">자세히 <i class="fa fa-arrow-circle-right"></i></a>
              </div>
            </div><!-- ./col -->
            <div class="col-lg-3 col-xs-6">
              <!-- small box -->
              <div class="small-box bg-yellow">
                <div class="inner">
                  <h3 id="visitor-count">{{ visitor_count }}</h3>
                  <p>방문객 수</p>
                </div>
                <div class="icon">
                  <i class="ion ion-person-add"></i>
                </div>
                <a href="/static/mainapp/pages/charts/morris.html" class="small-box-footer">자세히 <i class="fa fa-arrow-circle-right"></i></a>
              </div>
            </div><!-- ./col -->
            <div class="col-lg-3 col-xs-6">
              <!-- small box -->
              <div class="small-box bg-aqua">
                <div class="inner">
                  <h3>86,300</h3>
                  <p>매출 통계</p>
                </div>
                <div class="icon">
                  <i class="ion ion-pie-graph"></i>
                </div>
                <a href="/static/mainapp/pages/charts/morris.html" class="small-box-footer">자세히 <i class="fa fa-arrow-circle-right"></i></a>
              </div>
            </div><!-- ./col -->
          </div><!-- /.row -->
          <!-- Main row -->
          <div class="row">
            <!-- Left col -->
            <section class="col-lg-7 connectedSortable">
              <div class="nav-tabs-custom" style="width: 100%; height: 520px;">
                  <!-- Tabs within a box -->
                  <ul class="nav nav-tabs pull-right">
                      <li class="pull-left header"><i class="fa fa-camera"></i> 실시간 CCTV </li>
                        <div class="box-tools pull-camera" style="margin-left: 72%;">
                        <button id="lockButton" class="btn btn-outline-dark" data-widget="collapse" onclick="toggleLock()" >
                          <i id="lockIcon" class="fa fa-lock"></i>
                        </button>
                  </ul>
                        <div class="tab-content no-padding" style="width: 100%; height: 100%; border: 0;">
                            <!-- 카메라 스트림 표시를 위한 video 태그 -->
                            <video id="cameraStream" width="100%" height="100%" autoplay muted></video>
                        </div>
              </div>
                          <br/>
            <!-- Calendar -->
            <div class="box box-solid bg-green-gradient">
              <div class="box-header">
                <i class="fa fa-calendar"></i>
                <h3 class="box-title">달력</h3>
                <!-- tools box -->
                <div class="pull-right box-tools">
                  <!-- button with a dropdown -->
                  <button class="btn btn-success btn-sm" data-widget="collapse"><i class="fa fa-minus"></i></button>
                  <button class="btn btn-success btn-sm" data-widget="remove"><i class="fa fa-times"></i></button>
                </div><!-- /. tools -->
              </div><!-- /.box-header -->
              <div class="box-body no-padding">
                <!--The calendar -->
                <div id="calendar" style="width: 100%"></div>
              </div><!-- /.box-body -->
            </div><!-- /.box -->
            </section><!-- /.Left col -->
            <!-- right col (We are only adding the ID to make the widgets sortable)-->
            <section class="col-lg-5 connectedSortable">

              <!-- solid sales graph -->
              <div class="box box-solid bg-teal-gradient" id="box1">
                <div class="box-header">
                  <i class="fa fa-bell-o"></i>
                  <h3 class="box-title">알림 감지 목록</h3>
                  <div class="box-tools pull-right">
                    <button class="btn bg-teal btn-sm" id="viewLogsButton">전체 로그 확인</button>
                    <button id="clearLogs" class="btn bg-teal btn-sm">로그 지우기</button>
                    <button id="toggleNotification" class="btn bg-teal btn-sm"><i id="notificationIcon" class="fa fa-bell"></i></button>
                    <button class="btn bg-teal btn-sm" data-widget="collapse"><i class="fa fa-minus"></i></button>
                  </div>
                 <div id="customBoxBody" class="box-body border-radius-none" style="font-size: 25px;">
                </div><!-- /.box-body -->
              </div>
                </div>


              <!-- Map box -->
              <div class="box box-solid bg-light-blue-gradient">
                <div class="box-header">
                  <!-- tools box -->
                  <div class="pull-right box-tools">
                    <button class="btn btn-primary btn-sm pull-right" data-widget='collapse' data-toggle="tooltip" title="Collapse" style="margin-right: 5px;"><i class="fa fa-minus"></i></button>
                  </div><!-- /. tools -->

                  <i class="fa fa-map-marker"></i>
                  <h3 class="box-title">
                    부산시 광역시 동구
                  </h3>
                </div>
                <div class="box-body">
                  <div>
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3909.316438623514!2d129.0371458809741!3d35.11469488524182!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3568e962bf20f95b%3A0xe242490559445cd2!2z652866eI64ukIOyVmey9lOultCDrsJTsnbQg7JyI642kIOu2gOyCsOyXrQ!5e0!3m2!1sko!2skr!4v1695095103414!5m2!1sko!2skr" width="100%;" height="488;" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

                 </div>
                </div><!-- /.box-body-->
              </div>
              <!-- /.box -->
            </section><!-- right col -->
          </div><!-- /.row (main row) -->

        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->
      <footer class="main-footer">
          <div class="btn-container"> <!-- 이 div가 추가됨 -->
              <a href="https://github.com/hodu31/LastProject_web" class="btn btn-social bg-navy btn-flat">
                  <i class="fa fa-github"></i> Go GitHub
              </a>
              <a href="https://www.instagram.com/noticare_team3/" class="btn btn-social bg-maroon btn-flat">
                  <i class="fa fa-instagram"></i> Go Instagram
              </a>
          </div>
          <strong>2023/05 ~ 2023/11 ::</strong>
          <b style="font-size: 15px"> 한국품질재단 - 빅데이터 분석가 양성과정</b>. The Last Project.
          <div class="pull-right hidden-xs">
              <a href="https://www.notion.so/_-3-53834d1bc4914d7e98f64b0ced5c7916"><b>Team 3 - Notion</b></a>
          </div>
      </footer>
    </div><!-- ./wrapper -->

    <div id="logs">
  <!-- Logs will be appended here -->
</div>

    <!-- jQuery 2.1.3 -->
    <script src="/static/mainapp/plugins/jQuery/jQuery-2.1.3.min.js"></script>
    <!-- jQuery UI 1.11.2 (s 추가)-->
    <script src="https://code.jquery.com/ui/1.11.2/jquery-ui.min.js" type="text/javascript"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
      $.widget.bridge('uibutton', $.ui.button);
    </script>
    <!-- Bootstrap 3.3.2 JS -->
    <script src="/static/mainapp/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>    
    <!-- Morris.js charts(s 추가) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="/static/mainapp/plugins/morris/morris.min.js" type="text/javascript"></script>
    <!-- Sparkline -->
    <script src="/static/mainapp/plugins/sparkline/jquery.sparkline.min.js" type="text/javascript"></script>
    <!-- jvectormap -->
    <script src="/static/mainapp/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js" type="text/javascript"></script>
    <script src="/static/mainapp/plugins/jvectormap/jquery-jvectormap-world-mill-en.js" type="text/javascript"></script>
    <!-- jQuery Knob Chart -->
    <script src="/static/mainapp/plugins/knob/jquery.knob.js" type="text/javascript"></script>
    <!-- daterangepicker -->
    <script src="/static/mainapp/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>
    <!-- datepicker -->
    <script src="/static/mainapp/plugins/datepicker/bootstrap-datepicker.js" type="text/javascript"></script>
    <!-- Bootstrap WYSIHTML5 -->
    <script src="/static/mainapp/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js" type="text/javascript"></script>
    <!-- iCheck -->
    <script src="/static/mainapp/plugins/iCheck/icheck.min.js" type="text/javascript"></script>
    <!-- Slimscroll -->
    <script src="/static/mainapp/plugins/slimScroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <!-- FastClick -->
    <script src='/static/mainapp/plugins/fastclick/fastclick.min.js'></script>
    <!-- AdminLTE App -->
    <script src="/static/mainapp/dist/js/app.min.js" type="text/javascript"></script>

    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="/static/mainapp/dist/js/pages/dashboard.js" type="text/javascript"></script>

    <!-- AdminLTE for demo purposes -->
    <script src="/static/mainapp/dist/js/demo.js" type="text/javascript"></script>

<!-- 텐서플로우 라이브러리 불러오기 -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>


<script>
// 카메라 접근 함수
async function setupCamera() {
  const devices = await navigator.mediaDevices.enumerateDevices();
  const cameraDevice = devices.find(device => device.kind === 'videoinput' && device.label.includes('HD20W'));

  let videoConfig;

  if (cameraDevice) {
    videoConfig = {
      video: {
        deviceId: { exact: cameraDevice.deviceId }
      }
    };
  } else {
    // 기본 웹캠을 사용하도록 설정
    videoConfig = { video: true };
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia(videoConfig);
    const videoElement = document.getElementById('cameraStream');
    videoElement.srcObject = stream;
  } catch (error) {
    console.error("Error accessing the camera", error);
  }
}

// 카메라 설정
setupCamera();


</script>
<!-- 임시                                    -->
<script>
  let detectedLogs = [];  
  let notificationEnabled = true;  

  Notification.requestPermission().then(function(permission) {
    if (permission === 'granted') {
        // 알림 권한이 부여됐을 때 실행되는 코드
    }
  });

  let lastNotifiedTime = 0;

  async function loadModel() {
      console.log('Loading model...');
      const net = await cocoSsd.load();
      console.log('Model loaded.');

      const video = document.getElementById('cameraStream');
      video.onloadedmetadata = function() {
          video.play();
          detectFromVideoFrame(net);
      };
  }

async function detectFromVideoFrame(net) {
    const video = document.getElementById('cameraStream');

    if (video.readyState === video.HAVE_ENOUGH_DATA) {
        try {
            const predictions = await net.detect(video);

            for (let i = 0; i < predictions.length; i++) {  
                if (predictions[i].class === 'person') {
                    const currentTime = Date.now();
                    if (currentTime - lastNotifiedTime > 30000 && notificationEnabled) {
                        const notification = new Notification("노티케어", {
                            body: '사람이 감지 되었습니다.',
                            icon: '/static/mainapp/dist/img/사람감지.jpg'
                        });

                        // 로그 저장
                        const timeString = new Date().toLocaleString();
                        detectedLogs.push(`${timeString} - 사람이 감지되었습니다.`);

                        // 특정한 box-body만 업데이트
                        const boxBody = document.getElementById('customBoxBody');
                        const newElement = document.createElement('div');
                        newElement.innerHTML = `<p>${timeString} - 사람이 감지되었습니다.</p>`;
                        boxBody.appendChild(newElement);


                        lastNotifiedTime = currentTime;
                        
                    }
                }
            }
        } catch (error) { 
            console.error('Error:', error);
        }
    }

    requestAnimationFrame(() => {
        detectFromVideoFrame(net);
    });
}
document.getElementById('clearLogs').addEventListener('click', function() {
  const boxBody = document.getElementById('customBoxBody');
  boxBody.innerHTML = '';  // 모든 로그 지우기
});
document.getElementById('toggleNotification').addEventListener('click', function() {
    notificationEnabled = !notificationEnabled;
    console.log("notificationEnabled:", notificationEnabled);  // 상태 출력
    const iconElement = document.getElementById('notificationIcon');
    if (notificationEnabled) {
        iconElement.className = "fa fa-bell";
    } else {
        iconElement.className = "fa fa-bell-slash";
    }
});


      loadModel();  // 모델 로딩 함수도 호출

</script>
<!-- 임시                                    -->
<script>
// Initialize empty log array
const detectedLogs1 = [];

// Mapping of DAN_CODE to words
const codeToWord = {
    1: '구매',
    2: '비교',
    3: '방화',
    4: '기절',
    5: '선택',
    6: '흡연',
    7: '절도',
    8: '유기',
};

let ws = null;

// 웹소켓 연결 함수
function connect() {
  // ws = new WebSocket("ws://127.0.0.1:8000/ws");
  ws = new WebSocket("wss://3.39.24.74:443/ws");
  ws.onopen = function(event) {
    console.log("웹소켓 연결 성공");
  };

  ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    const timeString = new Date().toLocaleString();
    const message = codeToWord[data.dan_code] || "알 수 없는 행동";

    // Trigger web push notification
    if (Notification.permission === "granted") {
        new Notification('노티케어', {
            icon: '/static/mainapp/dist/img/위험.png',
            body: `${message} 행동이 감지 되었습니다.`
        });
    }

    // Update specific box-body
    const boxBody = document.getElementById('customBoxBody');
    const newElement = document.createElement('div');
    newElement.innerHTML = `<p>${timeString} - ${message} 행동이 감지 되었습니다.</p>`;
    boxBody.appendChild(newElement);
  };

  ws.onclose = function(event) {
    console.log("웹소켓 연결 끊김, 재연결 시도");
    setTimeout(connect, 5000);  // 5초 후 재연결 시도
  };

  ws.onerror = function(event) {
    console.error("웹소켓 에러 발생", event);
  };
}

// 초기 연결
connect();
</script>

<script>
function toggleLock() {
    const lockIcon = document.getElementById("lockIcon");
    if (lockIcon.classList.contains("fa-lock")) {
        lockIcon.classList.remove("fa-lock");
        lockIcon.classList.add("fa-unlock");
        window.open('/lockscreen', '_blank', 'width=400,height=300');
    } else {
        lockIcon.classList.remove("fa-unlock");
        lockIcon.classList.add("fa-lock");
    }
}
</script>

<script>
  document.getElementById('viewLogsButton').addEventListener('click', function() {
    window.open('/log_table', '_blank', 'width=700,height=600');
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  setInterval(async () => {
    try {
      // dan_count 가져오기
      const danResponse = await fetch("/get_dan_count");
      const danData = await danResponse.json();
      document.getElementById("dan-count").innerText = danData.dan_count;

      // visitor_count 가져오기
      const visitorResponse = await fetch("/get_visitor_count");
      const visitorData = await visitorResponse.json();
      document.getElementById("visitor-count").innerText = visitorData.visitor_count;

      // dan_count2 가져오기
      const dan2Response = await fetch("/get_dan_count2");
      const dan2Data = await dan2Response.json();
      document.getElementById("dan2-count").innerText = dan2Data.dan_count2; 
        
    } catch (error) {
      console.error("Could not update counts:", error);
    }
  }, 1000);
});

</script>


  </body>
</html>